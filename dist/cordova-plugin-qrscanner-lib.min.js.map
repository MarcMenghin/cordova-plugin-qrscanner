{"version":3,"sources":["webpack://QRScanner/webpack/universalModuleDefinition","webpack://QRScanner/webpack/bootstrap","webpack://QRScanner/./node_modules/sdp/sdp.js","webpack://QRScanner/./node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","webpack://QRScanner/./src/browser/src/library.js","webpack://QRScanner/./src/common/src/createQRScannerAdapter.js","webpack://QRScanner/./src/browser/src/createQRScannerInternal.js","webpack://QRScanner/./src/browser/worker.min.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/utils.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/edge/getusermedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/common_shim.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://QRScanner/./node_modules/webrtc-adapter/src/js/adapter_factory.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","SDPUtils","Math","random","toString","substr","localCName","generateIdentifier","splitLines","blob","trim","split","map","line","splitSections","part","index","getDescription","sections","getMediaSections","shift","matchPrefix","prefix","filter","indexOf","parseCandidate","parts","candidate","foundation","substring","component","parseInt","protocol","toLowerCase","priority","ip","address","port","type","length","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","sdp","push","toUpperCase","join","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","undefined","preferredPayloadType","parseExtmap","id","direction","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","parameters","keys","params","forEach","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","slice","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","kind","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","JSON","parse","stringify","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","obj","cname","rsize","reducedSize","compound","mux","parseMsid","spec","stream","track","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","isNaN","sctpPort","fmt","writeSctpDescription","media","sctp","output","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","version","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected","parseOLine","username","sessionId","sessionVersion","netType","addressType","isValidSDP","charAt","dtlsRole","trackId","_initialTrackId","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","findCodecByPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","rCodec","min","lHeaderExtension","rHeaderExtension","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","find","remoteCandidate","addRemoteCandidate","makeError","e","Error","code","NotSupportedError","InvalidStateError","InvalidAccessError","TypeError","OperationError","edgeVersion","addTrackToStreamAndFireEvent","addTrack","dispatchEvent","MediaStreamTrackEvent","fireAddTrack","pc","receiver","streams","trackEvent","Event","setTimeout","_dispatchEvent","RTCPeerConnection","config","this","_eventTarget","document","createDocumentFragment","method","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceConnectionState","connectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","iceServers","hasTurn","server","urls","url","console","warn","isString","filterIceServers","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","configurable","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","event","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","addEventListener","enabled","removeTrack","sender","stop","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","writable","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","serializedCandidate","assign","toJSON","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","encodings","receive","Promise","reject","isIceLite","rejected","remoteIceParameters","remoteDtlsParameters","start","_updateSignalingState","resolve","receiverList","iceOptions","remoteMsid","isComplete","cands","setTransport","setRemoteCandidates","MediaStream","default","RTCRtpReceiver","getCapabilities","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","item","close","newState","states","closed","checking","connected","completed","disconnected","failed","new","connecting","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","addIceCandidate","candidateString","getStats","selector","MediaStreamTrack","senderOrReceiver","promises","all","then","allStats","results","Map","stats","stat","set","ortcObjectName","nativeGetstats","apply","nativeStats","mapStats","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","methods","nativeMethod","args","error","createQRScannerAdapter","internal","createQRScannerInternal","functionList","prepare","show","hide","scan","cancelScan","pausePreview","resumePreview","enableLight","disableLight","useCamera","openSettings","getStatus","destroy","getFunc","callback","exec","successCallback","errorCallback","className","functionName","inputArray","cordova","stringToBool","string","convertStatus","statusDictionary","authorized","denied","restricted","prepared","scanning","previewing","showing","lightEnabled","canOpenSettings","canEnableLight","canChangeCamera","currentCamera","QRScannerError","_message","statusDict","doneCallback","clear","body","style","backgroundColor","backgroundImage","parentNode","result","useFrontCamera","useBackCamera","workerScript","ELEMENTS","ZINDEXES","backCamera","frontCamera","activeMediaStream","scanWorker","thisScanCycle","nextScan","cancelNextScan","standardWidthsAndHeights","facingModes","killStream","mediaStream","chooseCameras","navigator","mediaDevices","enumerateDevices","mediaDeviceInfoList","elem","deviceId","videoDeviceIds","searches","getConstraintObj","facingMode","width","height","audio","video","exact","facingModeConstraints","widthConstraints","heightConstraints","getFirstResolvingConstraint","constraintsBestToWorst","resolveBestConstraints","reduce","chain","next","searchState","found","nextConstraint","getUserMedia","facingModeSpecs","widthSpecs","heightSpecs","getCameraSpecsById","cameraSpecsArray","camera","sort","a","b","bestToWorstCameras","mediaStreamIsActive","killActiveMediaStream","getVideoPreview","getElementById","getImg","getCurrentCameraIndex","getCurrentCamera","isInitialized","calcStatus","getTempCanvasAndContext","videoElement","tempCanvas","createElement","tempCanvasContext","getContext","drawImage","canvas","context","initialize","success","workerBlob","Blob","Worker","URL","createObjectURL","videoPreview","setAttribute","img","visibility","stillImg","appendChild","cameras","err","showCamera","currentCameraIndex","ideal","src","startCamera","ignore","returned","onmessage","data","snapshot","postMessage","getImageData","SCAN_INTERVAL","QRScanner_SCAN_INTERVAL","sendError","clearTimeout","pause","Image","toDataURL","bringStillToFront","array","requestedCamera","initialized","status","preview","still","remove","logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","modifiedEvent","handleEvent","_eventMap","nativeRemoveEventListener","has","unwrappedCb","delete","size","disableLog","bool","disableWarnings","log","deprecated","oldMethod","newMethod","detectBrowser","browser","mozGetUserMedia","userAgent","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","supportsUnifiedPlan","RTCRtpTransceiver","isObject","val","compactObject","accumulator","isObj","isEmptyObject","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","walkStats","base","resultSet","endsWith","shimGetUserMedia","browserDetails","constraintsToChrome_","cc","max","oldname_","oc","mix","advanced","concat","shimConstraints_","constraints","func","remap","face","getSupportedFacingModeLies","getSupportedConstraints","matches","devices","dev","some","label","includes","shimError_","PermissionDeniedError","PermissionDismissedError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","onSuccess","onError","origGetUserMedia","cs","DOMException","shimGetDisplayMedia","getSourceId","getDisplayMedia","sourceId","widthSpecified","heightSpecified","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","shimMediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","_ontrackpoly","te","shimGetSendersWithDtmf","shimSenderWithDtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","shimGetStats","origGetStats","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","timestamp","names","makeMapStats","successCallbackWrapper_","shimSenderReceiverGetStats","origGetReceivers","receivers","srcElement","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","alreadyExists","oldStream","methodObj","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","addIceCandidateNullSupported","RTCIceCandidate","nativeAddIceCandidate","fixNegotiationNeeded","target","sdpSemantics","catch","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","validTurn","startsWith","shimReplaceTrack","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","test","rid","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","getParameters","setParameters","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","finally","shimCreateAnswer","origCreateAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","tracks","shimRemoteStreamsAPI","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","failureCallback","options","promise","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","audioTransceiver","getTransceivers","setDirection","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","shimMaxMessageSize","_sctp","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","byteLength","readyState","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","removeAllowExtmapMixed","nativeSRD","shimChrome","shimFirefox","shimEdge","shimSafari","logging","adapter","commonShim","browserShim","adapterFactory"],"mappings":"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","file":"cordova-plugin-qrscanner-lib.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"QRScanner\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"QRScanner\"] = factory();\n\telse\n\t\troot[\"QRScanner\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  var parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES paramters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all fieldѕ are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // ѕdpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete‥\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","function QRScanner() {\r\n  var createQRScannerAdapter = require('../../common/src/createQRScannerAdapter.js');\r\n  var createQRScannerInternal = require('./createQRScannerInternal.js');\r\n\r\n  var internal = createQRScannerInternal();\r\n  var functionList = {\r\n      prepare: internal.prepare,\r\n      show: internal.show,\r\n      hide: internal.hide,\r\n      scan: internal.scan,\r\n      cancelScan: internal.cancelScan,\r\n      pausePreview: internal.pausePreview,\r\n      resumePreview: internal.resumePreview,\r\n      enableLight: internal.enableLight,\r\n      disableLight: internal.disableLight,\r\n      useCamera: internal.useCamera,\r\n      openSettings: internal.openSettings,\r\n      getStatus: internal.getStatus,\r\n      destroy: internal.destroy\r\n  };\r\n\r\n  // always returns an executable function for use by the internal component\r\n  // if a callback is provided, use it\r\n  function getFunc(callback){\r\n    if(typeof callback === \"function\"){\r\n      return callback;\r\n    }\r\n    return function(){\r\n      // callback is not needed\r\n      return;\r\n    };\r\n  }\r\n\r\n  // shim cordova's functionality for library usage\r\n  var shimCordova = {\r\n    exec: function(successCallback, errorCallback, className, functionName, inputArray){\r\n      if(className !== 'QRScanner' || !functionList[functionName]){\r\n        return errorCallback(0);\r\n      }\r\n      if(inputArray){\r\n        functionList[functionName](getFunc(successCallback), getFunc(errorCallback), inputArray);\r\n      } else {\r\n        functionList[functionName](getFunc(successCallback), getFunc(errorCallback));\r\n      }\r\n    }\r\n  };\r\n\r\n  var adapter = createQRScannerAdapter(shimCordova);\r\n  return adapter;\r\n}\r\n\r\nmodule.exports = new QRScanner();\r\n","module.exports = function createQRScanner(cordova){\r\n// The native implementations should return their status as ['string':'string']\r\n// dictionaries. Boolean values are encoded to '0' and '1', respectively.\r\nfunction stringToBool(string) {\r\n  switch (string) {\r\n    case '1':\r\n      return true;\r\n    case '0':\r\n      return false;\r\n    default:\r\n    throw new Error('QRScanner plugin returned an invalid boolean number-string: ' + string);\r\n  }\r\n}\r\n\r\n// Converts the returned ['string':'string'] dictionary to a status object.\r\nfunction convertStatus(statusDictionary) {\r\n  return {\r\n    authorized: stringToBool(statusDictionary.authorized),\r\n    denied: stringToBool(statusDictionary.denied),\r\n    restricted: stringToBool(statusDictionary.restricted),\r\n    prepared: stringToBool(statusDictionary.prepared),\r\n    scanning: stringToBool(statusDictionary.scanning),\r\n    previewing: stringToBool(statusDictionary.previewing),\r\n    showing: stringToBool(statusDictionary.showing),\r\n    lightEnabled: stringToBool(statusDictionary.lightEnabled),\r\n    canOpenSettings: stringToBool(statusDictionary.canOpenSettings),\r\n    canEnableLight: stringToBool(statusDictionary.canEnableLight),\r\n    canChangeCamera: stringToBool(statusDictionary.canChangeCamera),\r\n    currentCamera: parseInt(statusDictionary.currentCamera)\r\n  };\r\n}\r\n\r\n// Simple utility method to ensure the background is transparent. Used by the\r\n// plugin to force re-rendering immediately after the native webview background\r\n// is made transparent.\r\nfunction clearBackground() {\r\n  var body = document.body;\r\n  if (body.style) {\r\n    body.style.backgroundColor = 'rgba(0,0,0,0.01)';\r\n    body.style.backgroundImage = '';\r\n    setTimeout(function() {\r\n      body.style.backgroundColor = 'transparent';\r\n    }, 1);\r\n    if (body.parentNode && body.parentNode.style) {\r\n      body.parentNode.style.backgroundColor = 'transparent';\r\n      body.parentNode.style.backgroundImage = '';\r\n    }\r\n  }\r\n}\r\n\r\nfunction errorCallback(callback) {\r\n  if (!callback) {\r\n    return null;\r\n  }\r\n  return function(error) {\r\n    var errorCode = parseInt(error);\r\n    var QRScannerError = {};\r\n    switch (errorCode) {\r\n      case 0:\r\n        QRScannerError = {\r\n          name: 'UNEXPECTED_ERROR',\r\n          code: 0,\r\n          _message: 'QRScanner experienced an unexpected error.'\r\n        };\r\n        break;\r\n      case 1:\r\n        QRScannerError = {\r\n          name: 'CAMERA_ACCESS_DENIED',\r\n          code: 1,\r\n          _message: 'The user denied camera access.'\r\n        };\r\n        break;\r\n      case 2:\r\n        QRScannerError = {\r\n          name: 'CAMERA_ACCESS_RESTRICTED',\r\n          code: 2,\r\n          _message: 'Camera access is restricted.'\r\n        };\r\n        break;\r\n      case 3:\r\n        QRScannerError = {\r\n          name: 'BACK_CAMERA_UNAVAILABLE',\r\n          code: 3,\r\n          _message: 'The back camera is unavailable.'\r\n        };\r\n        break;\r\n      case 4:\r\n        QRScannerError = {\r\n          name: 'FRONT_CAMERA_UNAVAILABLE',\r\n          code: 4,\r\n          _message: 'The front camera is unavailable.'\r\n        };\r\n        break;\r\n      case 5:\r\n        QRScannerError = {\r\n          name: 'CAMERA_UNAVAILABLE',\r\n          code: 5,\r\n          _message: 'The camera is unavailable.'\r\n        };\r\n        break;\r\n      case 6:\r\n        QRScannerError = {\r\n          name: 'SCAN_CANCELED',\r\n          code: 6,\r\n          _message: 'Scan was canceled.'\r\n        };\r\n        break;\r\n      case 7:\r\n        QRScannerError = {\r\n          name: 'LIGHT_UNAVAILABLE',\r\n          code: 7,\r\n          _message: 'The device light is unavailable.'\r\n        };\r\n        break;\r\n      case 8:\r\n        // Open settings is only available on iOS 8.0+.\r\n        QRScannerError = {\r\n          name: 'OPEN_SETTINGS_UNAVAILABLE',\r\n          code: 8,\r\n          _message: 'The device is unable to open settings.'\r\n        };\r\n        break;\r\n      default:\r\n        QRScannerError = {\r\n          name: 'UNEXPECTED_ERROR',\r\n          code: 0,\r\n          _message: 'QRScanner returned an invalid error code.'\r\n        };\r\n        break;\r\n    }\r\n    callback(QRScannerError);\r\n  };\r\n}\r\n\r\nfunction successCallback(callback) {\r\n  if (!callback) {\r\n    return null;\r\n  }\r\n  return function(statusDict) {\r\n    callback(null, convertStatus(statusDict));\r\n  };\r\n}\r\n\r\nfunction doneCallback(callback, clear) {\r\n  if (!callback) {\r\n    return null;\r\n  }\r\n  return function(statusDict) {\r\n    if (clear) {\r\n      clearBackground();\r\n    }\r\n    callback(convertStatus(statusDict));\r\n  };\r\n}\r\n\r\nreturn {\r\n  prepare: function(callback) {\r\n    cordova.exec(successCallback(callback), errorCallback(callback), 'QRScanner', 'prepare', []);\r\n  },\r\n  destroy: function(callback) {\r\n    cordova.exec(doneCallback(callback, true), null, 'QRScanner', 'destroy', []);\r\n  },\r\n  scan: function(callback) {\r\n    if (!callback) {\r\n      throw new Error('No callback provided to scan method.');\r\n    }\r\n    var success = function(result) {\r\n      callback(null, result);\r\n    };\r\n    cordova.exec(success, errorCallback(callback), 'QRScanner', 'scan', []);\r\n  },\r\n  cancelScan: function(callback) {\r\n    cordova.exec(doneCallback(callback), null, 'QRScanner', 'cancelScan', []);\r\n  },\r\n  show: function(callback) {\r\n    cordova.exec(doneCallback(callback, true), null, 'QRScanner', 'show', []);\r\n  },\r\n  hide: function(callback) {\r\n    cordova.exec(doneCallback(callback, true), null, 'QRScanner', 'hide', []);\r\n  },\r\n  pausePreview: function(callback) {\r\n    cordova.exec(doneCallback(callback), null, 'QRScanner', 'pausePreview', []);\r\n  },\r\n  resumePreview: function(callback) {\r\n    cordova.exec(doneCallback(callback), null, 'QRScanner', 'resumePreview', []);\r\n  },\r\n  enableLight: function(callback) {\r\n    cordova.exec(successCallback(callback), errorCallback(callback), 'QRScanner', 'enableLight', []);\r\n  },\r\n  disableLight: function(callback) {\r\n    cordova.exec(successCallback(callback), errorCallback(callback), 'QRScanner', 'disableLight', []);\r\n  },\r\n  useCamera: function(index, callback) {\r\n    cordova.exec(successCallback(callback), errorCallback(callback), 'QRScanner', 'useCamera', [index]);\r\n  },\r\n  useFrontCamera: function(callback) {\r\n    var frontCamera = 1;\r\n    if (callback) {\r\n      this.useCamera(frontCamera, callback);\r\n    } else {\r\n      cordova.exec(null, null, 'QRScanner', 'useCamera', [frontCamera]);\r\n    }\r\n  },\r\n  useBackCamera: function(callback) {\r\n    var backCamera = 0;\r\n    if (callback) {\r\n      this.useCamera(backCamera, callback);\r\n    } else {\r\n      cordova.exec(null, null, 'QRScanner', 'useCamera', [backCamera]);\r\n    }\r\n  },\r\n  openSettings: function(callback) {\r\n    if (callback) {\r\n      cordova.exec(successCallback(callback), errorCallback(callback), 'QRScanner', 'openSettings', []);\r\n    } else {\r\n      cordova.exec(null, null, 'QRScanner', 'openSettings', []);\r\n    }\r\n  },\r\n  getStatus: function(callback) {\r\n    if (!callback) {\r\n      throw new Error('No callback provided to getStatus method.');\r\n    }\r\n    cordova.exec(doneCallback(callback), null, 'QRScanner', 'getStatus', []);\r\n  }\r\n};\r\n};\r\n","require('webrtc-adapter');\r\nvar workerScript = require(\"raw-loader!../worker.min.js\");\r\n\r\nmodule.exports = function(){\r\n\r\n  var ELEMENTS = {\r\n    preview: 'cordova-plugin-qrscanner-video-preview',\r\n    still: 'cordova-plugin-qrscanner-still'\r\n  };\r\n  var ZINDEXES = {\r\n    preview: -100,\r\n    still: -99\r\n  };\r\n  var backCamera = null;\r\n  var frontCamera = null;\r\n  var currentCamera = 0;\r\n  var activeMediaStream = null;\r\n  var scanning = false;\r\n  var previewing = false;\r\n  var scanWorker = null;\r\n  var thisScanCycle = null;\r\n  var nextScan = null;\r\n  var cancelNextScan = null;\r\n\r\n  // standard screen widths/heights, from 4k down to 320x240\r\n  // widths and heights are each tested separately to account for screen rotation\r\n  var standardWidthsAndHeights = [\r\n    5120, 4096, 3840, 3440, 3200, 3072, 3000, 2880, 2800, 2736, 2732, 2560,\r\n    2538, 2400, 2304, 2160, 2100, 2048, 2000, 1920, 1856, 1824, 1800, 1792,\r\n    1776, 1728, 1700, 1680, 1600, 1536, 1440, 1400, 1392, 1366, 1344, 1334,\r\n    1280, 1200, 1152, 1136, 1120, 1080, 1050, 1024, 1000, 960, 900, 854, 848,\r\n    832, 800, 768, 750, 720, 640, 624, 600, 576, 544, 540, 512, 480, 320, 240\r\n  ];\r\n\r\n  var facingModes = [\r\n    'environment',\r\n    'user'\r\n  ];\r\n\r\n  //utils\r\n  function killStream(mediaStream){\r\n    mediaStream.getTracks().forEach(function(track){\r\n      track.stop();\r\n    });\r\n  }\r\n\r\n  // For performance, we test best-to-worst constraints. Once we find a match,\r\n  // we move to the next test. Since `ConstraintNotSatisfiedError`s are thrown\r\n  // much faster than streams can be started and stopped, the scan is much\r\n  // faster, even though it may iterate through more constraint objects.\r\n  function getCameraSpecsById(deviceId){\r\n\r\n    // return a getUserMedia Constraints\r\n    function getConstraintObj(deviceId, facingMode, width, height){\r\n      var obj = { audio: false, video: {} };\r\n      obj.video.deviceId = {exact: deviceId};\r\n      if(facingMode) {\r\n        obj.video.facingMode = {exact: facingMode};\r\n      }\r\n      if(width) {\r\n        obj.video.width = {exact: width};\r\n      }\r\n      if(height) {\r\n        obj.video.height = {exact: height};\r\n      }\r\n      return obj;\r\n    }\r\n\r\n    var facingModeConstraints = facingModes.map(function(mode){\r\n    \treturn getConstraintObj(deviceId, mode);\r\n    });\r\n    var widthConstraints = standardWidthsAndHeights.map(function(width){\r\n    \treturn getConstraintObj(deviceId, null, width);\r\n    });\r\n    var heightConstraints = standardWidthsAndHeights.map(function(height){\r\n    \treturn getConstraintObj(deviceId, null, null, height);\r\n    });\r\n\r\n    // create a promise which tries to resolve the best constraints for this deviceId\r\n    // rather than reject, failures return a value of `null`\r\n    function getFirstResolvingConstraint(constraintsBestToWorst){\r\n      return new Promise(function(resolveBestConstraints){\r\n        // build a chain of promises which either resolves or continues searching\r\n        return constraintsBestToWorst.reduce(function(chain, next){\r\n          return chain.then(function(searchState){\r\n            if(searchState.found){\r\n              // The best working constraint was found. Skip further tests.\r\n              return searchState;\r\n            } else {\r\n              searchState.nextConstraint = next;\r\n              return window.navigator.mediaDevices.getUserMedia(searchState.nextConstraint).then(function(mediaStream){\r\n                // We found the first working constraint object, now we can stop\r\n                // the stream and short-circuit the search.\r\n                killStream(mediaStream);\r\n                searchState.found = true;\r\n                return searchState;\r\n              }, function(){\r\n                // didn't get a media stream. The search continues:\r\n                return searchState;\r\n              });\r\n            }\r\n          });\r\n        }, Promise.resolve({\r\n          // kick off the search:\r\n          found: false,\r\n          nextConstraint: {}\r\n        })).then(function(searchState){\r\n          if(searchState.found){\r\n            resolveBestConstraints(searchState.nextConstraint);\r\n          } else {\r\n            resolveBestConstraints(null);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    return getFirstResolvingConstraint(facingModeConstraints).then(function(facingModeSpecs){\r\n      return getFirstResolvingConstraint(widthConstraints).then(function(widthSpecs){\r\n        return getFirstResolvingConstraint(heightConstraints).then(function(heightSpecs){\r\n          return {\r\n            deviceId: deviceId,\r\n            facingMode: facingModeSpecs === null ? null : facingModeSpecs.video.facingMode.exact,\r\n            width: widthSpecs === null ? null : widthSpecs.video.width.exact,\r\n            height: heightSpecs === null ? null : heightSpecs.video.height.exact\r\n          };\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  function chooseCameras(){\r\n    var devices = window.navigator.mediaDevices.enumerateDevices();\r\n    return devices.then(function(mediaDeviceInfoList){\r\n      var videoDeviceIds = mediaDeviceInfoList.filter(function(elem){\r\n        return elem.kind === 'videoinput';\r\n      }).map(function(elem){\r\n        return elem.deviceId;\r\n      });\r\n      return videoDeviceIds;\r\n    }).then(function(videoDeviceIds){\r\n      // there is no standardized way for us to get the specs of each camera\r\n      // (due to concerns over user fingerprinting), so we're forced to\r\n      // iteratively test each camera for it's capabilities\r\n      var searches = [];\r\n      videoDeviceIds.forEach(function(id){\r\n        searches.push(getCameraSpecsById(id));\r\n      });\r\n      return Promise.all(searches);\r\n    }).then(function(cameraSpecsArray){\r\n      return cameraSpecsArray.filter(function(camera){\r\n        // filter out any cameras where width and height could not be captured\r\n        if(camera !== null && camera.width !== null && camera.height !== null){\r\n          return true;\r\n        }\r\n      }).sort(function(a, b){\r\n        // sort cameras from highest resolution (by width) to lowest\r\n        return b.width - a.width;\r\n      });\r\n    }).then(function(bestToWorstCameras){\r\n      var backCamera = null,\r\n          frontCamera = null;\r\n      // choose backCamera\r\n      for(var i = 0; i < bestToWorstCameras.length; i++){\r\n        if (bestToWorstCameras[i].facingMode === 'environment'){\r\n          backCamera = bestToWorstCameras[i];\r\n          // (shouldn't be used for frontCamera)\r\n          bestToWorstCameras.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n      // if no back-facing cameras were found, choose the highest resolution\r\n      if(backCamera === null){\r\n        if(bestToWorstCameras.length > 0){\r\n          backCamera = bestToWorstCameras[0];\r\n          // (shouldn't be used for frontCamera)\r\n          bestToWorstCameras.splice(0, 1);\r\n        } else {\r\n          // user doesn't have any available cameras\r\n          backCamera = false;\r\n        }\r\n      }\r\n      if(bestToWorstCameras.length > 0){\r\n        // frontCamera should simply be the next-best resolution camera\r\n        frontCamera = bestToWorstCameras[0];\r\n      } else {\r\n        // user doesn't have any more cameras\r\n        frontCamera = false;\r\n      }\r\n      return {\r\n        backCamera: backCamera,\r\n        frontCamera: frontCamera\r\n      };\r\n    });\r\n  }\r\n\r\n  function mediaStreamIsActive(){\r\n    return activeMediaStream !== null;\r\n  }\r\n\r\n  function killActiveMediaStream(){\r\n    killStream(activeMediaStream);\r\n    activeMediaStream = null;\r\n  }\r\n\r\n  function getVideoPreview(){\r\n    return document.getElementById(ELEMENTS.preview);\r\n  }\r\n\r\n  function getImg(){\r\n    return document.getElementById(ELEMENTS.still);\r\n  }\r\n\r\n  function getCurrentCameraIndex(){\r\n    return currentCamera;\r\n  }\r\n\r\n  function getCurrentCamera(){\r\n    return currentCamera === 1 ? frontCamera : backCamera;\r\n  }\r\n\r\n  function bringStillToFront(){\r\n    var img = getImg();\r\n    if(img){\r\n      img.style.visibility = 'visible';\r\n      previewing = false;\r\n    }\r\n  }\r\n\r\n  function bringPreviewToFront(){\r\n    var img = getImg();\r\n    if(img){\r\n      img.style.visibility = 'hidden';\r\n      previewing = true;\r\n    }\r\n  }\r\n\r\n  function isInitialized(){\r\n    return backCamera !== null;\r\n  }\r\n\r\n  function canChangeCamera(){\r\n    return !!backCamera && !!frontCamera;\r\n  }\r\n\r\n  function calcStatus(){\r\n    return {\r\n      // !authorized means the user either has no camera or has denied access.\r\n      // This would leave a value of `null` before prepare(), and `false` after.\r\n      authorized: (backCamera !== null && backCamera !== false)? '1': '0',\r\n      // No applicable API\r\n      denied: '0',\r\n      // No applicable API\r\n      restricted: '0',\r\n      prepared: isInitialized() ? '1' : '0',\r\n      scanning: scanning? '1' : '0',\r\n      previewing: previewing? '1' : '0',\r\n      // We leave this true after prepare() to match the mobile experience as\r\n      // closely as possible. (Without additional covering, the preview will\r\n      // always be visible to the user).\r\n      showing: getVideoPreview()? '1' : '0',\r\n      // No applicable API\r\n      lightEnabled: '0',\r\n      // No applicable API\r\n      canOpenSettings: '0',\r\n      // No applicable API\r\n      canEnableLight: '0',\r\n      canChangeCamera: canChangeCamera() ? '1' : '0',\r\n      currentCamera: currentCamera.toString()\r\n    };\r\n  }\r\n\r\n  function startCamera(success, error){\r\n      var currentCameraIndex = getCurrentCameraIndex();\r\n      var currentCamera = getCurrentCamera();\r\n      window.navigator.mediaDevices.getUserMedia({\r\n        audio: false,\r\n        video: {\r\n          deviceId: {exact: currentCamera.deviceId},\r\n          width: {ideal: currentCamera.width},\r\n          height: {ideal: currentCamera.height}\r\n        }\r\n      }).then(function(mediaStream){\r\n        activeMediaStream = mediaStream;\r\n        var video = getVideoPreview();\r\n        video.src = URL.createObjectURL(mediaStream);\r\n        success(calcStatus());\r\n      }, function(err){\r\n        // something bad happened\r\n        err = null;\r\n        var code = currentCameraIndex? 4 : 3;\r\n        error(code); // FRONT_CAMERA_UNAVAILABLE : BACK_CAMERA_UNAVAILABLE\r\n      });\r\n  }\r\n\r\n  function getTempCanvasAndContext(videoElement){\r\n    var tempCanvas = document.createElement('canvas');\r\n    var camera = getCurrentCamera();\r\n    tempCanvas.height = camera.height;\r\n    tempCanvas.width = camera.width;\r\n    var tempCanvasContext = tempCanvas.getContext('2d');\r\n    tempCanvasContext.drawImage(videoElement, 0, 0, camera.width, camera.height);\r\n    return {\r\n      canvas: tempCanvas,\r\n      context: tempCanvasContext\r\n    };\r\n  }\r\n\r\n  function getCurrentImageData(videoElement){\r\n    var snapshot = getTempCanvasAndContext(videoElement);\r\n    return snapshot.context.getImageData(0, 0, snapshot.canvas.width, snapshot.canvas.height);\r\n  }\r\n\r\n  // take a screenshot of the video preview with a temp canvas\r\n  function captureCurrentFrame(videoElement){\r\n    return getTempCanvasAndContext(videoElement).canvas.toDataURL('image/png');\r\n  }\r\n\r\n  function initialize(success, error){\r\n    if(scanWorker === null){\r\n      var workerBlob = new Blob([workerScript],{type: \"text/javascript\"});\r\n      scanWorker = new Worker(URL.createObjectURL(workerBlob));\r\n    }\r\n    if(!getVideoPreview()){\r\n      // prepare DOM (sync)\r\n      var videoPreview = document.createElement('video');\r\n      videoPreview.setAttribute('autoplay', 'autoplay');\r\n      videoPreview.setAttribute('id', ELEMENTS.preview);\r\n      videoPreview.setAttribute('style', 'display:block;position:fixed;top:50%;left:50%;' +\r\n      'width:auto;height:auto;min-width:100%;min-height:100%;z-index:' + ZINDEXES.preview +\r\n      ';-moz-transform: translateX(-50%) translateY(-50%);-webkit-transform: ' +\r\n      'translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);' +\r\n      'background-size:cover;background-position:50% 50%;background-color:#FFF;');\r\n      videoPreview.addEventListener('loadeddata', function(){\r\n        bringPreviewToFront();\r\n      });\r\n\r\n      var stillImg = document.createElement('div');\r\n      stillImg.setAttribute('id', ELEMENTS.still);\r\n      stillImg.setAttribute('style', 'display:block;position:fixed;top:50%;left:50%;visibility: hidden;' +\r\n      'width:auto;height:auto;min-width:100%;min-height:100%;z-index:' + ZINDEXES.still +\r\n      ';-moz-transform: translateX(-50%) translateY(-50%);-webkit-transform: ' +\r\n      'translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);' +\r\n      'background-size:cover;background-position:50% 50%;background-color:#FFF;');\r\n\r\n      document.body.appendChild(videoPreview);\r\n      document.body.appendChild(stillImg);\r\n    }\r\n    if(backCamera === null){\r\n      // set instance cameras\r\n      chooseCameras().then(function(cameras){\r\n        backCamera = cameras.backCamera;\r\n        frontCamera = cameras.frontCamera;\r\n        if(backCamera !== false){\r\n          success();\r\n        } else {\r\n          error(5); // CAMERA_UNAVAILABLE\r\n        }\r\n      }, function(err){\r\n        // something bad happened\r\n        err = null;\r\n        error(0); // UNEXPECTED_ERROR\r\n      });\r\n    } else if (backCamera === false){\r\n      error(5); // CAMERA_UNAVAILABLE\r\n    } else {\r\n      success();\r\n    }\r\n  }\r\n\r\n  /*\r\n   *  --- Begin Public API ---\r\n   */\r\n\r\n  function prepare(success, error){\r\n    initialize(function(){\r\n      // return status on success\r\n      success(calcStatus());\r\n    },\r\n    // pass errors through\r\n    error);\r\n  }\r\n\r\n  function show(success, error){\r\n    function showCamera(){\r\n      if(!mediaStreamIsActive()){\r\n        startCamera(success, error);\r\n      } else {\r\n        success(calcStatus());\r\n      }\r\n    }\r\n    if(!isInitialized()){\r\n      initialize(function(){\r\n        // on successful initialization, attempt to showCamera\r\n        showCamera();\r\n      },\r\n      // pass errors through\r\n      error);\r\n    } else {\r\n      showCamera();\r\n    }\r\n  }\r\n\r\n  function hide(success, error){\r\n    error = null; // should never error\r\n    if(mediaStreamIsActive()){\r\n      killActiveMediaStream();\r\n    }\r\n    var video = getVideoPreview();\r\n    if(video){\r\n      video.src = '';\r\n    }\r\n    success(calcStatus());\r\n  }\r\n\r\n  function scan(success, error) {\r\n    // initialize and start video preview if not already active\r\n    show(function(ignore){\r\n      // ignore success output – `scan` method callback should be passed the decoded data\r\n      ignore = null;\r\n      var video = getVideoPreview();\r\n      var returned = false;\r\n      scanning = true;\r\n      scanWorker.onmessage = function(event){\r\n        var obj = event.data;\r\n        if(obj.result && !returned){\r\n          returned = true;\r\n          thisScanCycle = null;\r\n          success(obj.result);\r\n        }\r\n      };\r\n      thisScanCycle = function(){\r\n        scanWorker.postMessage(getCurrentImageData(video));\r\n        if(cancelNextScan !== null){\r\n          // avoid race conditions, always clear before starting a cycle\r\n          cancelNextScan();\r\n        }\r\n        // interval in milliseconds at which to try decoding the QR code\r\n        var SCAN_INTERVAL = window.QRScanner_SCAN_INTERVAL || 130;\r\n        // this value can be adjusted on-the-fly (while a scan is active) to\r\n        // balance scan speed vs. CPU/power usage\r\n        nextScan = window.setTimeout(thisScanCycle, SCAN_INTERVAL);\r\n        cancelNextScan = function(sendError){\r\n          window.clearTimeout(nextScan);\r\n          nextScan = null;\r\n          cancelNextScan = null;\r\n          if(sendError){\r\n            error(6); // SCAN_CANCELED\r\n          }\r\n        };\r\n      };\r\n      thisScanCycle();\r\n    }, error);\r\n  }\r\n\r\n  function cancelScan(success, error){\r\n    error = null; // should never error\r\n    if(cancelNextScan !== null){\r\n      cancelNextScan(true);\r\n    }\r\n    scanning = false;\r\n    if(typeof success === \"function\"){\r\n      success(calcStatus());\r\n    }\r\n  }\r\n\r\n  function pausePreview(success, error){\r\n    error = null; // should never error\r\n    if(mediaStreamIsActive()){\r\n      // pause scanning too\r\n      if(cancelNextScan !== null){\r\n        cancelNextScan();\r\n      }\r\n      var video = getVideoPreview();\r\n      video.pause();\r\n      var img = new Image();\r\n      img.src = captureCurrentFrame(video);\r\n      getImg().style.backgroundImage = 'url(' + img.src + ')';\r\n      bringStillToFront();\r\n      // kill the active stream to turn off the privacy light (the screenshot\r\n      // in the stillImg will remain visible)\r\n      killActiveMediaStream();\r\n      success(calcStatus());\r\n    } else {\r\n      success(calcStatus());\r\n    }\r\n  }\r\n\r\n  function resumePreview(success, error){\r\n    // if a scan was happening, resume it\r\n    if(thisScanCycle !== null){\r\n      thisScanCycle();\r\n    }\r\n    show(success, error);\r\n  }\r\n\r\n  function enableLight(success, error){\r\n    error(7); //LIGHT_UNAVAILABLE\r\n  }\r\n\r\n  function disableLight(success, error){\r\n    error(7); //LIGHT_UNAVAILABLE\r\n  }\r\n\r\n  function useCamera(success, error, array){\r\n    var requestedCamera = array[0];\r\n    var initialized = isInitialized();\r\n    if(requestedCamera !== currentCamera){\r\n      if(initialized && requestedCamera === 1 && !canChangeCamera()){\r\n          error(4); //FRONT_CAMERA_UNAVAILABLE\r\n      } else {\r\n        currentCamera = requestedCamera;\r\n        if(initialized){\r\n          hide(function(status){\r\n            // Don't need this one\r\n            status = null;\r\n          });\r\n          show(success, error);\r\n        } else {\r\n          success(calcStatus());\r\n        }\r\n      }\r\n    } else {\r\n      success(calcStatus());\r\n    }\r\n  }\r\n\r\n  function openSettings(success, error){\r\n    error(8); //OPEN_SETTINGS_UNAVAILABLE\r\n  }\r\n\r\n  function getStatus(success, error){\r\n    error = null; // should never error\r\n    success(calcStatus());\r\n  }\r\n\r\n  // Reset all instance variables to their original state.\r\n  // This method might be useful in cases where a new camera is available, and\r\n  // the application needs to force the plugin to chooseCameras() again.\r\n  function destroy(success, error){\r\n    error = null; // should never error\r\n    cancelScan();\r\n    if(mediaStreamIsActive()){\r\n      killActiveMediaStream();\r\n    }\r\n    backCamera = null;\r\n    frontCamera = null;\r\n    var preview = getVideoPreview();\r\n    var still = getImg();\r\n    if(preview){\r\n      preview.remove();\r\n    }\r\n    if(still){\r\n      still.remove();\r\n    }\r\n    success(calcStatus());\r\n  }\r\n\r\n  return {\r\n      prepare: prepare,\r\n      show: show,\r\n      hide: hide,\r\n      scan: scan,\r\n      cancelScan: cancelScan,\r\n      pausePreview: pausePreview,\r\n      resumePreview: resumePreview,\r\n      enableLight: enableLight,\r\n      disableLight: disableLight,\r\n      useCamera: useCamera,\r\n      openSettings: openSettings,\r\n      getStatus: getStatus,\r\n      destroy: destroy\r\n  };\r\n};\r\n","export default \"!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\\\"undefined\\\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\\\"Module\\\"}),Object.defineProperty(t,\\\"__esModule\\\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\\\"object\\\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\\\"default\\\",{enumerable:!0,value:t}),2&e&&\\\"string\\\"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\\\"a\\\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\\\"\\\",n(n.s=0)}([function(t,e,n){(function(t){var e=new(0,n(2).default);e.callback=function(t,e){postMessage({result:e,err:t})},onmessage=function(t){var n=t.data;e.decode(n)}}).call(this,n(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,\\\"loaded\\\",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,\\\"id\\\",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){\\\"use strict\\\";function r(t,e,n){this.ordinal_Renamed_Field=t,this.bits=e,this.name=n}n.r(e),r.prototype.ordinal=function(){return this.ordinal_Renamed_Field},r.forBits=function(t){if(t<0||t>=i.length)throw\\\"ArgumentException\\\";return i[t]};var i=[new r(1,0,\\\"M\\\"),new r(0,1,\\\"L\\\"),new r(3,2,\\\"H\\\"),new r(2,3,\\\"Q\\\")],o=[[21522,0],[20773,1],[24188,2],[23371,3],[17913,4],[16590,5],[20375,6],[19104,7],[30660,8],[29427,9],[32170,10],[30877,11],[26159,12],[25368,13],[27713,14],[26998,15],[5769,16],[5054,17],[7399,18],[6608,19],[1890,20],[597,21],[3340,22],[2107,23],[13663,24],[12392,25],[16177,26],[14854,27],[9396,28],[8579,29],[11994,30],[11245,31]],s=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function a(t){this.errorCorrectionLevel=r.forBits(t>>3&3),this.dataMask=7&t}function h(t,e){if(e||(e=t),t<1||e<1)throw\\\"Both dimensions must be greater than 0\\\";this.width=t,this.height=e;var n=t>>5;0!=(31&t)&&n++,this.rowSize=n,this.bits=new Array(n*e);for(var r=0;r<this.bits.length;r++)this.bits[r]=0}function f(t,e){this.count=t,this.dataCodewords=e}function w(t,e,n){this.ecCodewordsPerBlock=t,this.ecBlocks=n?[e,n]:[e]}function u(t,e,n,r,i,o){this.versionNumber=t,this.alignmentPatternCenters=e,this.ecBlocks=[n,r,i,o];for(var s=0,a=n.ecCodewordsPerBlock,h=n.getECBlocks(),f=0;f<h.length;f++){var w=h[f];s+=w.count*(w.dataCodewords+a)}this.totalCodewords=s}function l(t,e,n){this.x=t,this.y=e,this.count=1,this.estimatedModuleSize=n}function d(t,e,n,r,i,o,s){this.image=t,this.possibleCenters=[],this.startX=e,this.startY=n,this.width=r,this.height=i,this.moduleSize=o,this.crossCheckStateCount=[0,0,0],this.resultPointCallback=s}a.prototype.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask},a.prototype.Equals=function(t){var e=t;return this.errorCorrectionLevel==e.errorCorrectionLevel&&this.dataMask==e.dataMask},a.numBitsDiffering=function(t,e){return s[15&(t^=e)]+s[15&I(t,4)]+s[15&I(t,8)]+s[15&I(t,12)]+s[15&I(t,16)]+s[15&I(t,20)]+s[15&I(t,24)]+s[15&I(t,28)]},a.decodeFormatInformation=function(t){var e=a.doDecodeFormatInformation(t);return null!=e?e:a.doDecodeFormatInformation(21522^t)},a.doDecodeFormatInformation=function(t){for(var e=4294967295,n=0,r=0;r<o.length;r++){var i=o[r],s=i[0];if(s==t)return new a(i[1]);var h=this.numBitsDiffering(t,s);h<e&&(n=i[1],e=h)}return e<=3?new a(n):null},Object.defineProperty(h.prototype,\\\"Dimension\\\",{get:function(){if(this.width!=this.height)throw\\\"Can't call getDimension() on a non-square matrix\\\";return this.width}}),h.prototype.get_Renamed=function(t,e){var n=e*this.rowSize+(t>>5);return 0!=(1&I(this.bits[n],31&t))},h.prototype.set_Renamed=function(t,e){var n=e*this.rowSize+(t>>5);this.bits[n]|=1<<(31&t)},h.prototype.flip=function(t,e){var n=e*this.rowSize+(t>>5);this.bits[n]^=1<<(31&t)},h.prototype.clear=function(){for(var t=this.bits.length,e=0;e<t;e++)this.bits[e]=0},h.prototype.setRegion=function(t,e,n,r){if(e<0||t<0)throw\\\"Left and top must be nonnegative\\\";if(r<1||n<1)throw\\\"Height and width must be at least 1\\\";var i=t+n,o=e+r;if(o>this.height||i>this.width)throw\\\"The region must fit inside the matrix\\\";for(var s=e;s<o;s++)for(var a=s*this.rowSize,h=t;h<i;h++)this.bits[a+(h>>5)]|=1<<(31&h)},Object.defineProperty(w.prototype,\\\"TotalECCodewords\\\",{get:function(){return this.ecCodewordsPerBlock*this.NumBlocks}}),Object.defineProperty(w.prototype,\\\"NumBlocks\\\",{get:function(){for(var t=0,e=0;e<this.ecBlocks.length;e++)t+=this.ecBlocks[e].length;return t}}),w.prototype.getECBlocks=function(){return this.ecBlocks},Object.defineProperty(u.prototype,\\\"DimensionForVersion\\\",{get:function(){return 17+4*this.versionNumber}}),u.prototype.buildFunctionPattern=function(){var t=this.DimensionForVersion,e=new h(t);e.setRegion(0,0,9,9),e.setRegion(t-8,0,8,9),e.setRegion(0,t-8,9,8);for(var n=this.alignmentPatternCenters.length,r=0;r<n;r++)for(var i=this.alignmentPatternCenters[r]-2,o=0;o<n;o++)0==r&&(0==o||o==n-1)||r==n-1&&0==o||e.setRegion(this.alignmentPatternCenters[o]-2,i,5,5);return e.setRegion(6,9,1,t-17),e.setRegion(9,6,t-17,1),this.versionNumber>6&&(e.setRegion(t-11,0,3,6),e.setRegion(0,t-11,6,3)),e},u.prototype.getECBlocksForLevel=function(t){return this.ecBlocks[t.ordinal()]},u.VERSION_DECODE_INFO=[31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017],u.VERSIONS=[new u(1,[],new w(7,new f(1,19)),new w(10,new f(1,16)),new w(13,new f(1,13)),new w(17,new f(1,9))),new u(2,[6,18],new w(10,new f(1,34)),new w(16,new f(1,28)),new w(22,new f(1,22)),new w(28,new f(1,16))),new u(3,[6,22],new w(15,new f(1,55)),new w(26,new f(1,44)),new w(18,new f(2,17)),new w(22,new f(2,13))),new u(4,[6,26],new w(20,new f(1,80)),new w(18,new f(2,32)),new w(26,new f(2,24)),new w(16,new f(4,9))),new u(5,[6,30],new w(26,new f(1,108)),new w(24,new f(2,43)),new w(18,new f(2,15),new f(2,16)),new w(22,new f(2,11),new f(2,12))),new u(6,[6,34],new w(18,new f(2,68)),new w(16,new f(4,27)),new w(24,new f(4,19)),new w(28,new f(4,15))),new u(7,[6,22,38],new w(20,new f(2,78)),new w(18,new f(4,31)),new w(18,new f(2,14),new f(4,15)),new w(26,new f(4,13),new f(1,14))),new u(8,[6,24,42],new w(24,new f(2,97)),new w(22,new f(2,38),new f(2,39)),new w(22,new f(4,18),new f(2,19)),new w(26,new f(4,14),new f(2,15))),new u(9,[6,26,46],new w(30,new f(2,116)),new w(22,new f(3,36),new f(2,37)),new w(20,new f(4,16),new f(4,17)),new w(24,new f(4,12),new f(4,13))),new u(10,[6,28,50],new w(18,new f(2,68),new f(2,69)),new w(26,new f(4,43),new f(1,44)),new w(24,new f(6,19),new f(2,20)),new w(28,new f(6,15),new f(2,16))),new u(11,[6,30,54],new w(20,new f(4,81)),new w(30,new f(1,50),new f(4,51)),new w(28,new f(4,22),new f(4,23)),new w(24,new f(3,12),new f(8,13))),new u(12,[6,32,58],new w(24,new f(2,92),new f(2,93)),new w(22,new f(6,36),new f(2,37)),new w(26,new f(4,20),new f(6,21)),new w(28,new f(7,14),new f(4,15))),new u(13,[6,34,62],new w(26,new f(4,107)),new w(22,new f(8,37),new f(1,38)),new w(24,new f(8,20),new f(4,21)),new w(22,new f(12,11),new f(4,12))),new u(14,[6,26,46,66],new w(30,new f(3,115),new f(1,116)),new w(24,new f(4,40),new f(5,41)),new w(20,new f(11,16),new f(5,17)),new w(24,new f(11,12),new f(5,13))),new u(15,[6,26,48,70],new w(22,new f(5,87),new f(1,88)),new w(24,new f(5,41),new f(5,42)),new w(30,new f(5,24),new f(7,25)),new w(24,new f(11,12),new f(7,13))),new u(16,[6,26,50,74],new w(24,new f(5,98),new f(1,99)),new w(28,new f(7,45),new f(3,46)),new w(24,new f(15,19),new f(2,20)),new w(30,new f(3,15),new f(13,16))),new u(17,[6,30,54,78],new w(28,new f(1,107),new f(5,108)),new w(28,new f(10,46),new f(1,47)),new w(28,new f(1,22),new f(15,23)),new w(28,new f(2,14),new f(17,15))),new u(18,[6,30,56,82],new w(30,new f(5,120),new f(1,121)),new w(26,new f(9,43),new f(4,44)),new w(28,new f(17,22),new f(1,23)),new w(28,new f(2,14),new f(19,15))),new u(19,[6,30,58,86],new w(28,new f(3,113),new f(4,114)),new w(26,new f(3,44),new f(11,45)),new w(26,new f(17,21),new f(4,22)),new w(26,new f(9,13),new f(16,14))),new u(20,[6,34,62,90],new w(28,new f(3,107),new f(5,108)),new w(26,new f(3,41),new f(13,42)),new w(30,new f(15,24),new f(5,25)),new w(28,new f(15,15),new f(10,16))),new u(21,[6,28,50,72,94],new w(28,new f(4,116),new f(4,117)),new w(26,new f(17,42)),new w(28,new f(17,22),new f(6,23)),new w(30,new f(19,16),new f(6,17))),new u(22,[6,26,50,74,98],new w(28,new f(2,111),new f(7,112)),new w(28,new f(17,46)),new w(30,new f(7,24),new f(16,25)),new w(24,new f(34,13))),new u(23,[6,30,54,74,102],new w(30,new f(4,121),new f(5,122)),new w(28,new f(4,47),new f(14,48)),new w(30,new f(11,24),new f(14,25)),new w(30,new f(16,15),new f(14,16))),new u(24,[6,28,54,80,106],new w(30,new f(6,117),new f(4,118)),new w(28,new f(6,45),new f(14,46)),new w(30,new f(11,24),new f(16,25)),new w(30,new f(30,16),new f(2,17))),new u(25,[6,32,58,84,110],new w(26,new f(8,106),new f(4,107)),new w(28,new f(8,47),new f(13,48)),new w(30,new f(7,24),new f(22,25)),new w(30,new f(22,15),new f(13,16))),new u(26,[6,30,58,86,114],new w(28,new f(10,114),new f(2,115)),new w(28,new f(19,46),new f(4,47)),new w(28,new f(28,22),new f(6,23)),new w(30,new f(33,16),new f(4,17))),new u(27,[6,34,62,90,118],new w(30,new f(8,122),new f(4,123)),new w(28,new f(22,45),new f(3,46)),new w(30,new f(8,23),new f(26,24)),new w(30,new f(12,15),new f(28,16))),new u(28,[6,26,50,74,98,122],new w(30,new f(3,117),new f(10,118)),new w(28,new f(3,45),new f(23,46)),new w(30,new f(4,24),new f(31,25)),new w(30,new f(11,15),new f(31,16))),new u(29,[6,30,54,78,102,126],new w(30,new f(7,116),new f(7,117)),new w(28,new f(21,45),new f(7,46)),new w(30,new f(1,23),new f(37,24)),new w(30,new f(19,15),new f(26,16))),new u(30,[6,26,52,78,104,130],new w(30,new f(5,115),new f(10,116)),new w(28,new f(19,47),new f(10,48)),new w(30,new f(15,24),new f(25,25)),new w(30,new f(23,15),new f(25,16))),new u(31,[6,30,56,82,108,134],new w(30,new f(13,115),new f(3,116)),new w(28,new f(2,46),new f(29,47)),new w(30,new f(42,24),new f(1,25)),new w(30,new f(23,15),new f(28,16))),new u(32,[6,34,60,86,112,138],new w(30,new f(17,115)),new w(28,new f(10,46),new f(23,47)),new w(30,new f(10,24),new f(35,25)),new w(30,new f(19,15),new f(35,16))),new u(33,[6,30,58,86,114,142],new w(30,new f(17,115),new f(1,116)),new w(28,new f(14,46),new f(21,47)),new w(30,new f(29,24),new f(19,25)),new w(30,new f(11,15),new f(46,16))),new u(34,[6,34,62,90,118,146],new w(30,new f(13,115),new f(6,116)),new w(28,new f(14,46),new f(23,47)),new w(30,new f(44,24),new f(7,25)),new w(30,new f(59,16),new f(1,17))),new u(35,[6,30,54,78,102,126,150],new w(30,new f(12,121),new f(7,122)),new w(28,new f(12,47),new f(26,48)),new w(30,new f(39,24),new f(14,25)),new w(30,new f(22,15),new f(41,16))),new u(36,[6,24,50,76,102,128,154],new w(30,new f(6,121),new f(14,122)),new w(28,new f(6,47),new f(34,48)),new w(30,new f(46,24),new f(10,25)),new w(30,new f(2,15),new f(64,16))),new u(37,[6,28,54,80,106,132,158],new w(30,new f(17,122),new f(4,123)),new w(28,new f(29,46),new f(14,47)),new w(30,new f(49,24),new f(10,25)),new w(30,new f(24,15),new f(46,16))),new u(38,[6,32,58,84,110,136,162],new w(30,new f(4,122),new f(18,123)),new w(28,new f(13,46),new f(32,47)),new w(30,new f(48,24),new f(14,25)),new w(30,new f(42,15),new f(32,16))),new u(39,[6,26,54,82,110,138,166],new w(30,new f(20,117),new f(4,118)),new w(28,new f(40,47),new f(7,48)),new w(30,new f(43,24),new f(22,25)),new w(30,new f(10,15),new f(67,16))),new u(40,[6,30,58,86,114,142,170],new w(30,new f(19,118),new f(6,119)),new w(28,new f(18,47),new f(31,48)),new w(30,new f(34,24),new f(34,25)),new w(30,new f(20,15),new f(61,16)))],u.getVersionForNumber=function(t){if(t<1||t>40)throw\\\"ArgumentException\\\";return u.VERSIONS[t-1]},u.getProvisionalVersionForDimension=function(t){if(t%4!=1)throw\\\"Error getProvisionalVersionForDimension\\\";try{return u.getVersionForNumber(t-17>>2)}catch(t){throw\\\"Error getVersionForNumber\\\"}},u.decodeVersionInformation=function(t){for(var e=4294967295,n=0,r=0;r<u.VERSION_DECODE_INFO.length;r++){var i=u.VERSION_DECODE_INFO[r];if(i==t)return this.getVersionForNumber(r+7);var o=a.numBitsDiffering(t,i);o<e&&(n=r+7,e=o)}return e<=3?this.getVersionForNumber(n):null},Object.defineProperty(l.prototype,\\\"X\\\",{get:function(){return Math.floor(this.x)}}),Object.defineProperty(l.prototype,\\\"Y\\\",{get:function(){return Math.floor(this.y)}}),l.prototype.incrementCount=function(){this.count++},l.prototype.aboutEquals=function(t,e,n){if(Math.abs(e-this.y)<=t&&Math.abs(n-this.x)<=t){var r=Math.abs(t-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1},d.prototype.centerFromEnd=function(t,e){return e-t[2]-t[1]/2},d.prototype.foundPatternCross=function(t){for(var e=this.moduleSize,n=e/2,r=0;r<3;r++)if(Math.abs(e-t[r])>=n)return!1;return!0},d.prototype.crossCheckVertical=function(t,e,n,r){var i=this.image,o=i.height,s=this.crossCheckStateCount;s[0]=0,s[1]=0,s[2]=0;for(var a=t;a>=0&&i.data[e+a*i.width]&&s[1]<=n;)s[1]++,a--;if(a<0||s[1]>n)return NaN;for(;a>=0&&!i.data[e+a*i.width]&&s[0]<=n;)s[0]++,a--;if(s[0]>n)return NaN;for(a=t+1;a<o&&i.data[e+a*i.width]&&s[1]<=n;)s[1]++,a++;if(a==o||s[1]>n)return NaN;for(;a<o&&!i.data[e+a*i.width]&&s[2]<=n;)s[2]++,a++;if(s[2]>n)return NaN;var h=s[0]+s[1]+s[2];return 5*Math.abs(h-r)>=2*r?NaN:this.foundPatternCross(s)?this.centerFromEnd(s,a):NaN},d.prototype.handlePossibleCenter=function(t,e,n){var r=t[0]+t[1]+t[2],i=this.centerFromEnd(t,n),o=this.crossCheckVertical(e,Math.floor(i),2*t[1],r);if(!isNaN(o)){for(var s=(t[0]+t[1]+t[2])/3,a=this.possibleCenters.length,h=0;h<a;h++){if(this.possibleCenters[h].aboutEquals(s,o,i))return new l(i,o,s)}var f=new l(i,o,s);this.possibleCenters.push(f),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(f)}return null},d.prototype.find=function(){for(var t=this.image,e=this.startX,n=this.height,r=e+this.width,i=this.startY+(n>>1),o=[0,0,0],s=0;s<n;s++){var a=i+(0==(1&s)?s+1>>1:-(s+1>>1));o[0]=0,o[1]=0,o[2]=0;for(var h=e;h<r&&!t.data[h+t.width*a];)h++;for(var f=0;h<r;){if(t.data[h+a*t.width])if(1==f)o[f]++;else if(2==f){var w;if(this.foundPatternCross(o))if(null!=(w=this.handlePossibleCenter(o,a,h)))return w;o[0]=o[2],o[1]=1,o[2]=0,f=1}else o[++f]++;else 1==f&&f++,o[f]++;h++}if(this.foundPatternCross(o))if(null!=(w=this.handlePossibleCenter(o,a,r)))return w}if(0!=this.possibleCenters.length)return this.possibleCenters[0];throw\\\"Couldn't find enough alignment patterns\\\"};var c={checkAndNudgePoints:function(t,e){for(var n=t.width,r=t.height,i=!0,o=0;o<e.length&&i;o+=2){var s=Math.floor(e[o]),a=Math.floor(e[o+1]);if(s<-1||s>n||a<-1||a>r)throw\\\"Error.checkAndNudgePoints \\\";i=!1,-1==s?(e[o]=0,i=!0):s==n&&(e[o]=n-1,i=!0),-1==a?(e[o+1]=0,i=!0):a==r&&(e[o+1]=r-1,i=!0)}i=!0;for(o=e.length-2;o>=0&&i;o-=2){s=Math.floor(e[o]),a=Math.floor(e[o+1]);if(s<-1||s>n||a<-1||a>r)throw\\\"Error.checkAndNudgePoints \\\";i=!1,-1==s?(e[o]=0,i=!0):s==n&&(e[o]=n-1,i=!0),-1==a?(e[o+1]=0,i=!0):a==r&&(e[o+1]=r-1,i=!0)}},sampleGrid3:function(t,e,n){for(var r=new h(e),i=new Array(e<<1),o=0;o<e;o++){for(var s=i.length,a=o+.5,f=0;f<s;f+=2)i[f]=.5+(f>>1),i[f+1]=a;n.transformPoints1(i),c.checkAndNudgePoints(t,i);try{for(f=0;f<s;f+=2){t.data[Math.floor(i[f])+t.width*Math.floor(i[f+1])]&&r.set_Renamed(f>>1,o)}}catch(t){throw\\\"Error.checkAndNudgePoints\\\"}}return r}},p=c;function g(t,e,n){this.x=t,this.y=e,this.count=1,this.estimatedModuleSize=n}function v(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}function m(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=[0,0,0,0,0],this.resultPointCallback=null}function b(t,e,n,r,i,o,s,a,h){this.a11=t,this.a12=r,this.a13=s,this.a21=e,this.a22=i,this.a23=a,this.a31=n,this.a32=o,this.a33=h}function y(t,e){this.bits=t,this.points=e}function C(t){this.image=t,this.resultPointCallback=null}function M(t,e){if(null==e||0==e.length)throw\\\"System.ArgumentException\\\";this.field=t;var n=e.length;if(n>1&&0==e[0]){for(var r=1;r<n&&0==e[r];)r++;if(r==n)this.coefficients=t.Zero.coefficients;else{this.coefficients=new Array(n-r);for(var i=0;i<this.coefficients.length;i++)this.coefficients[i]=0;for(var o=0;o<this.coefficients.length;o++)this.coefficients[o]=e[r+o]}}else this.coefficients=e}function k(t){this.expTable=new Array(256),this.logTable=new Array(256);for(var e=1,n=0;n<256;n++)this.expTable[n]=e,(e<<=1)>=256&&(e^=t);for(n=0;n<255;n++)this.logTable[this.expTable[n]]=n;var r=new Array(1);r[0]=0,this.zero=new M(this,new Array(r));var i=new Array(1);i[0]=1,this.one=new M(this,new Array(i))}function P(t){this.field=t}Object.defineProperty(g.prototype,\\\"X\\\",{get:function(){return this.x}}),Object.defineProperty(g.prototype,\\\"Y\\\",{get:function(){return this.y}}),g.prototype.incrementCount=function(){this.count++},g.prototype.aboutEquals=function(t,e,n){if(Math.abs(e-this.y)<=t&&Math.abs(n-this.x)<=t){var r=Math.abs(t-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1},Object.defineProperty(m.prototype,\\\"CrossCheckStateCount\\\",{get:function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount}}),m.prototype.foundPatternCross=function(t){for(var e=0,n=0;n<5;n++){var r=t[n];if(0==r)return!1;e+=r}if(e<7)return!1;var i=Math.floor((e<<8)/7),o=Math.floor(i/2);return Math.abs(i-(t[0]<<8))<o&&Math.abs(i-(t[1]<<8))<o&&Math.abs(3*i-(t[2]<<8))<3*o&&Math.abs(i-(t[3]<<8))<o&&Math.abs(i-(t[4]<<8))<o},m.prototype.centerFromEnd=function(t,e){return e-t[4]-t[3]-t[2]/2},m.prototype.crossCheckVertical=function(t,e,n,r){for(var i=this.image,o=i.height,s=this.CrossCheckStateCount,a=t;a>=0&&i.data[e+a*i.width];)s[2]++,a--;if(a<0)return NaN;for(;a>=0&&!i.data[e+a*i.width]&&s[1]<=n;)s[1]++,a--;if(a<0||s[1]>n)return NaN;for(;a>=0&&i.data[e+a*i.width]&&s[0]<=n;)s[0]++,a--;if(s[0]>n)return NaN;for(a=t+1;a<o&&i.data[e+a*i.width];)s[2]++,a++;if(a==o)return NaN;for(;a<o&&!i.data[e+a*i.width]&&s[3]<n;)s[3]++,a++;if(a==o||s[3]>=n)return NaN;for(;a<o&&i.data[e+a*i.width]&&s[4]<n;)s[4]++,a++;if(s[4]>=n)return NaN;var h=s[0]+s[1]+s[2]+s[3]+s[4];return 5*Math.abs(h-r)>=2*r?NaN:this.foundPatternCross(s)?this.centerFromEnd(s,a):NaN},m.prototype.crossCheckHorizontal=function(t,e,n,r){for(var i=this.image,o=i.width,s=this.CrossCheckStateCount,a=t;a>=0&&i.data[a+e*i.width];)s[2]++,a--;if(a<0)return NaN;for(;a>=0&&!i.data[a+e*i.width]&&s[1]<=n;)s[1]++,a--;if(a<0||s[1]>n)return NaN;for(;a>=0&&i.data[a+e*i.width]&&s[0]<=n;)s[0]++,a--;if(s[0]>n)return NaN;for(a=t+1;a<o&&i.data[a+e*i.width];)s[2]++,a++;if(a==o)return NaN;for(;a<o&&!i.data[a+e*i.width]&&s[3]<n;)s[3]++,a++;if(a==o||s[3]>=n)return NaN;for(;a<o&&i.data[a+e*i.width]&&s[4]<n;)s[4]++,a++;if(s[4]>=n)return NaN;var h=s[0]+s[1]+s[2]+s[3]+s[4];return 5*Math.abs(h-r)>=r?NaN:this.foundPatternCross(s)?this.centerFromEnd(s,a):NaN},m.prototype.handlePossibleCenter=function(t,e,n){var r=t[0]+t[1]+t[2]+t[3]+t[4],i=this.centerFromEnd(t,n),o=this.crossCheckVertical(e,Math.floor(i),t[2],r);if(!isNaN(o)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(o),t[2],r),!isNaN(i))){for(var s=r/7,a=!1,h=this.possibleCenters.length,f=0;f<h;f++){var w=this.possibleCenters[f];if(w.aboutEquals(s,o,i)){w.incrementCount(),a=!0;break}}if(!a){var u=new g(i,o,s);this.possibleCenters.push(u),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(u)}return!0}return!1},m.prototype.selectBestPatterns=function(){var t=this.possibleCenters.length;if(t<3)throw\\\"Couldn't find enough finder patterns:\\\"+t+\\\" patterns found\\\";if(t>3){for(var e=0,n=0,r=0;r<t;r++){var i=this.possibleCenters[r].estimatedModuleSize;e+=i,n+=i*i}var o=e/t;this.possibleCenters.sort((function(t,e){var n=Math.abs(e.estimatedModuleSize-o),r=Math.abs(t.estimatedModuleSize-o);return n<r?-1:n==r?0:1}));var s=Math.sqrt(n/t-o*o),a=Math.max(.2*o,s);for(r=this.possibleCenters-1;r>=0;r--){var h=this.possibleCenters[r];Math.abs(h.estimatedModuleSize-o)>a&&this.possibleCenters.splice(r,1)}}return this.possibleCenters.length>3&&this.possibleCenters.sort((function(t,e){return t.count>e.count?-1:t.count<e.count?1:0})),[this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2]]},m.prototype.findRowSkip=function(){var t=this.possibleCenters.length;if(t<=1)return 0;for(var e=null,n=0;n<t;n++){var r=this.possibleCenters[n];if(r.count>=2){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.X-r.X)-Math.abs(e.Y-r.Y))/2);e=r}}return 0},m.prototype.haveMultiplyConfirmedCenters=function(){for(var t=0,e=0,n=this.possibleCenters.length,r=0;r<n;r++){var i=this.possibleCenters[r];i.count>=2&&(t++,e+=i.estimatedModuleSize)}if(t<3)return!1;var o=e/n,s=0;for(r=0;r<n;r++)i=this.possibleCenters[r],s+=Math.abs(i.estimatedModuleSize-o);return s<=.05*e},m.prototype.findFinderPattern=function(t){this.image=t;var e=t.height,n=t.width,r=Math.floor(3*e/228);r<3&&(r=3);for(var i=!1,o=new Array(5),s=r-1;s<e&&!i;s+=r){o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0;for(var a=0,h=0;h<n;h++)if(t.data[h+s*t.width])1==(1&a)&&a++,o[a]++;else if(0==(1&a))if(4==a)if(this.foundPatternCross(o)){if(this.handlePossibleCenter(o,s,h))if(r=2,this.hasSkipped)i=this.haveMultiplyConfirmedCenters();else{var f=this.findRowSkip();f>o[2]&&(s+=f-o[2]-r,h=n-1)}else{do{h++}while(h<n&&!t.data[h+s*t.width]);h--}a=0,o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0}else o[0]=o[2],o[1]=o[3],o[2]=o[4],o[3]=1,o[4]=0,a=3;else o[++a]++;else o[a]++;if(this.foundPatternCross(o))this.handlePossibleCenter(o,s,n)&&(r=o[0],this.hasSkipped&&(i=this.haveMultiplyConfirmedCenters()))}var w=this.selectBestPatterns();return function(t){function e(t,e){var n=t.X-e.X,r=t.Y-e.Y;return Math.sqrt(n*n+r*r)}var n,r,i,o=e(t[0],t[1]),s=e(t[1],t[2]),a=e(t[0],t[2]);if(s>=o&&s>=a?(r=t[0],n=t[1],i=t[2]):a>=s&&a>=o?(r=t[1],n=t[0],i=t[2]):(r=t[2],n=t[0],i=t[1]),function(t,e,n){var r=e.x,i=e.y;return(n.x-r)*(t.y-i)-(n.y-i)*(t.x-r)}(n,r,i)<0){var h=n;n=i,i=h}t[0]=n,t[1]=r,t[2]=i}(w),new v(w)},b.prototype.transformPoints1=function(t){for(var e=t.length,n=this.a11,r=this.a12,i=this.a13,o=this.a21,s=this.a22,a=this.a23,h=this.a31,f=this.a32,w=this.a33,u=0;u<e;u+=2){var l=t[u],d=t[u+1],c=i*l+a*d+w;t[u]=(n*l+o*d+h)/c,t[u+1]=(r*l+s*d+f)/c}},b.prototype.transformPoints2=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r],o=e[r],s=this.a13*i+this.a23*o+this.a33;t[r]=(this.a11*i+this.a21*o+this.a31)/s,e[r]=(this.a12*i+this.a22*o+this.a32)/s}},b.prototype.buildAdjoint=function(){return new b(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},b.prototype.times=function(t){return new b(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)},b.quadrilateralToQuadrilateral=function(t,e,n,r,i,o,s,a,h,f,w,u,l,d,c,p){var g=this.quadrilateralToSquare(t,e,n,r,i,o,s,a);return this.squareToQuadrilateral(h,f,w,u,l,d,c,p).times(g)},b.squareToQuadrilateral=function(t,e,n,r,i,o,s,a){var h=a-o,f=e-r+o-a;if(0==h&&0==f)return new b(n-t,i-n,t,r-e,o-r,e,0,0,1);var w=n-i,u=s-i,l=t-n+i-s,d=r-o,c=w*h-u*d,p=(l*h-u*f)/c,g=(w*f-l*d)/c;return new b(n-t+p*n,s-t+g*s,t,r-e+p*r,a-e+g*a,e,p,g,1)},b.quadrilateralToSquare=function(t,e,n,r,i,o,s,a){return this.squareToQuadrilateral(t,e,n,r,i,o,s,a).buildAdjoint()},C.prototype.sizeOfBlackWhiteBlackRun=function(t,e,n,r){var i=Math.abs(r-e)>Math.abs(n-t);if(i){var o=t;t=e,e=o,o=n,n=r,r=o}for(var s=Math.abs(n-t),a=Math.abs(r-e),h=-s>>1,f=e<r?1:-1,w=t<n?1:-1,u=0,l=t,d=e;l!=n;l+=w){var c=i?d:l,p=i?l:d;if(1==u?this.image.data[c+p*this.image.width]&&u++:this.image.data[c+p*this.image.width]||u++,3==u){var g=l-t,v=d-e;return Math.sqrt(g*g+v*v)}if((h+=a)>0){if(d==r)break;d+=f,h-=s}}var m=n-t,b=r-e;return Math.sqrt(m*m+b*b)},C.prototype.sizeOfBlackWhiteBlackRunBothWays=function(t,e,n,r){var i=this.sizeOfBlackWhiteBlackRun(t,e,n,r),o=1,s=t-(n-t);s<0?(o=t/(t-s),s=0):s>=this.image.width&&(o=(this.image.width-1-t)/(s-t),s=this.image.width-1);var a=Math.floor(e-(r-e)*o);return o=1,a<0?(o=e/(e-a),a=0):a>=this.image.height&&(o=(this.image.height-1-e)/(a-e),a=this.image.height-1),s=Math.floor(t+(s-t)*o),(i+=this.sizeOfBlackWhiteBlackRun(t,e,s,a))-1},C.prototype.calculateModuleSizeOneWay=function(t,e){var n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(e.X),Math.floor(e.Y)),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.X),Math.floor(e.Y),Math.floor(t.X),Math.floor(t.Y));return isNaN(n)?r/7:isNaN(r)?n/7:(n+r)/14},C.prototype.calculateModuleSize=function(t,e,n){return(this.calculateModuleSizeOneWay(t,e)+this.calculateModuleSizeOneWay(t,n))/2},C.prototype.distance=function(t,e){var n=t.X-e.X,r=t.Y-e.Y;return Math.sqrt(n*n+r*r)},C.prototype.computeDimension=function(t,e,n,r){var i=7+(Math.round(this.distance(t,e)/r)+Math.round(this.distance(t,n)/r)>>1);switch(3&i){case 0:i++;break;case 2:i--;break;case 3:throw\\\"Error\\\"}return i},C.prototype.findAlignmentInRegion=function(t,e,n,r){var i=Math.floor(r*t),o=Math.max(0,e-i),s=Math.min(this.image.width-1,e+i);if(s-o<3*t)throw\\\"Error\\\";var a=Math.max(0,n-i),h=Math.min(this.image.height-1,n+i);return new d(this.image,o,a,s-o,h-a,t,this.resultPointCallback).find()},C.prototype.createTransform=function(t,e,n,r,i){var o,s,a,h,f=i-3.5;return null!=r?(o=r.X,s=r.Y,a=h=f-3):(o=e.X-t.X+n.X,s=e.Y-t.Y+n.Y,a=h=f),b.quadrilateralToQuadrilateral(3.5,3.5,f,3.5,a,h,3.5,f,t.X,t.Y,e.X,e.Y,o,s,n.X,n.Y)},C.prototype.sampleGrid=function(t,e,n){return p.sampleGrid3(t,n,e)},C.prototype.processFinderPatternInfo=function(t){var e=t.topLeft,n=t.topRight,r=t.bottomLeft,i=this.calculateModuleSize(e,n,r);if(i<1)throw\\\"Error\\\";var o=this.computeDimension(e,n,r,i),s=u.getProvisionalVersionForDimension(o),a=s.DimensionForVersion-7,h=null;if(s.alignmentPatternCenters.length>0)for(var f=n.X-e.X+r.X,w=n.Y-e.Y+r.Y,l=1-3/a,d=Math.floor(e.X+l*(f-e.X)),c=Math.floor(e.Y+l*(w-e.Y)),p=4;p<=16;p<<=1){h=this.findAlignmentInRegion(i,d,c,p);break}var g=this.createTransform(e,n,r,h,o);return new y(this.sampleGrid(this.image,g,o),null==h?[r,e,n]:[r,e,n,h])},C.prototype.detect=function(){var t=(new m).findFinderPattern(this.image);return this.processFinderPatternInfo(t)},Object.defineProperty(M.prototype,\\\"Zero\\\",{get:function(){return 0==this.coefficients[0]}}),Object.defineProperty(M.prototype,\\\"Degree\\\",{get:function(){return this.coefficients.length-1}}),M.prototype.getCoefficient=function(t){return this.coefficients[this.coefficients.length-1-t]},M.prototype.evaluateAt=function(t){if(0==t)return this.getCoefficient(0);var e=this.coefficients.length;if(1==t){for(var n=0,r=0;r<e;r++)n=this.field.addOrSubtract(n,this.coefficients[r]);return n}var i=this.coefficients[0];for(r=1;r<e;r++)i=this.field.addOrSubtract(this.field.multiply(t,i),this.coefficients[r]);return i},M.prototype.addOrSubtract=function(t){if(this.field!=t.field)throw\\\"GF256Polys do not have same GF256 field\\\";if(this.Zero)return t;if(t.Zero)return this;var e=this.coefficients,n=t.coefficients;if(e.length>n.length){var r=e;e=n,n=r}for(var i=new Array(n.length),o=n.length-e.length,s=0;s<o;s++)i[s]=n[s];for(var a=o;a<n.length;a++)i[a]=this.field.addOrSubtract(e[a-o],n[a]);return new M(this.field,i)},M.prototype.multiply1=function(t){if(this.field!=t.field)throw\\\"GF256Polys do not have same GF256 field\\\";if(this.Zero||t.Zero)return this.field.Zero;for(var e=this.coefficients,n=e.length,r=t.coefficients,i=r.length,o=new Array(n+i-1),s=0;s<n;s++)for(var a=e[s],h=0;h<i;h++)o[s+h]=this.field.addOrSubtract(o[s+h],this.field.multiply(a,r[h]));return new M(this.field,o)},M.prototype.multiply2=function(t){if(0==t)return this.field.Zero;if(1==t)return this;for(var e=this.coefficients.length,n=new Array(e),r=0;r<e;r++)n[r]=this.field.multiply(this.coefficients[r],t);return new M(this.field,n)},M.prototype.multiplyByMonomial=function(t,e){if(t<0)throw\\\"System.ArgumentException\\\";if(0==e)return this.field.Zero;for(var n=this.coefficients.length,r=new Array(n+t),i=0;i<r.length;i++)r[i]=0;for(i=0;i<n;i++)r[i]=this.field.multiply(this.coefficients[i],e);return new M(this.field,r)},M.prototype.divide=function(t){if(this.field!=t.field)throw\\\"GF256Polys do not have same GF256 field\\\";if(t.Zero)throw\\\"Divide by 0\\\";for(var e=this.field.Zero,n=this,r=t.getCoefficient(t.Degree),i=this.field.inverse(r);n.Degree>=t.Degree&&!n.Zero;){var o=n.Degree-t.Degree,s=this.field.multiply(n.getCoefficient(n.Degree),i),a=t.multiplyByMonomial(o,s),h=this.field.buildMonomial(o,s);e=e.addOrSubtract(h),n=n.addOrSubtract(a)}return[e,n]},Object.defineProperty(k.prototype,\\\"Zero\\\",{get:function(){return this.zero}}),Object.defineProperty(k.prototype,\\\"One\\\",{get:function(){return this.one}}),k.prototype.buildMonomial=function(t,e){if(t<0)throw\\\"System.ArgumentException\\\";if(0==e)return this.zero;for(var n=new Array(t+1),r=0;r<n.length;r++)n[r]=0;return n[0]=e,new M(this,n)},k.prototype.exp=function(t){return this.expTable[t]},k.prototype.log=function(t){if(0==t)throw\\\"System.ArgumentException\\\";return this.logTable[t]},k.prototype.inverse=function(t){if(0==t)throw\\\"System.ArithmeticException\\\";return this.expTable[255-this.logTable[t]]},k.prototype.addOrSubtract=function(t,e){return t^e},k.prototype.multiply=function(t,e){return 0==t||0==e?0:1==t?e:1==e?t:this.expTable[(this.logTable[t]+this.logTable[e])%255]},k.QR_CODE_FIELD=new k(285),k.DATA_MATRIX_FIELD=new k(301),P.prototype.decode=function(t,e){for(var n=new M(this.field,t),r=new Array(e),i=0;i<r.length;i++)r[i]=0;var o=!0;for(i=0;i<e;i++){var s=n.evaluateAt(this.field.exp(i));r[r.length-1-i]=s,0!=s&&(o=!1)}if(!o){var a=new M(this.field,r),h=this.runEuclideanAlgorithm(this.field.buildMonomial(e,1),a,e),f=h[0],w=h[1],u=this.findErrorLocations(f),l=this.findErrorMagnitudes(w,u,!1);for(i=0;i<u.length;i++){var d=t.length-1-this.field.log(u[i]);if(d<0)throw\\\"ReedSolomonException Bad error location\\\";t[d]=k.prototype.addOrSubtract(t[d],l[i])}}},P.prototype.runEuclideanAlgorithm=function(t,e,n){if(t.Degree<e.Degree){var r=t;t=e,e=r}for(var i=t,o=e,s=this.field.One,a=this.field.Zero,h=this.field.Zero,f=this.field.One;o.Degree>=Math.floor(n/2);){var w=i,u=s,l=h;if(s=a,h=f,(i=o).Zero)throw\\\"r_{i-1} was zero\\\";o=w;for(var d=this.field.Zero,c=i.getCoefficient(i.Degree),p=this.field.inverse(c);o.Degree>=i.Degree&&!o.Zero;){var g=o.Degree-i.Degree,v=this.field.multiply(o.getCoefficient(o.Degree),p);d=d.addOrSubtract(this.field.buildMonomial(g,v)),o=o.addOrSubtract(i.multiplyByMonomial(g,v))}a=d.multiply1(s).addOrSubtract(u),f=d.multiply1(h).addOrSubtract(l)}var m=f.getCoefficient(0);if(0==m)throw\\\"ReedSolomonException sigmaTilde(0) was zero\\\";var b=this.field.inverse(m);return[f.multiply2(b),o.multiply2(b)]},P.prototype.findErrorLocations=function(t){var e=t.Degree;if(1==e)return new Array(t.getCoefficient(1));for(var n=new Array(e),r=0,i=1;i<256&&r<e;i++)0==t.evaluateAt(i)&&(n[r]=this.field.inverse(i),r++);if(r!=e)throw\\\"Error locator degree does not match number of roots\\\";return n},P.prototype.findErrorMagnitudes=function(t,e,n){for(var r=e.length,i=new Array(r),o=0;o<r;o++){for(var s=this.field.inverse(e[o]),a=1,h=0;h<r;h++)o!=h&&(a=this.field.multiply(a,k.prototype.addOrSubtract(1,this.field.multiply(e[h],s))));i[o]=this.field.multiply(t.evaluateAt(s),this.field.inverse(a)),n&&(i[o]=this.field.multiply(i[o],s))}return i};var S={};S.forReference=function(t){if(t<0||t>7)throw\\\"System.ArgumentException\\\";return S.DATA_MASKS[t]},S.DATA_MASKS=[new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return 0==(t+e&1)}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return 0==(1&t)}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return e%3==0}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return(t+e)%3==0}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return 0==(I(t,1)+e/3&1)}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){var n=t*e;return(1&n)+n%3==0}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){var n=t*e;return 0==((1&n)+n%3&1)}},new function(){this.unmaskBitMatrix=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)},this.isMasked=function(t,e){return 0==((t+e&1)+t*e%3&1)}}];var N=S;function B(t){var e=t.Dimension;if(e<21||1!=(3&e))throw\\\"Error BitMatrixParser\\\";this.bitMatrix=t,this.parsedVersion=null,this.parsedFormatInfo=null}function A(t,e){this.numDataCodewords=t,this.codewords=e}function x(t,e,n){this.blockPointer=0,this.bitPointer=7,this.dataLength=0,this.blocks=t,this.numErrorCorrectionCode=n,e<=9?this.dataLengthMode=0:e>=10&&e<=26?this.dataLengthMode=1:e>=27&&e<=40&&(this.dataLengthMode=2)}B.prototype.copyBit=function(t,e,n){return this.bitMatrix.get_Renamed(t,e)?n<<1|1:n<<1},B.prototype.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var t=0,e=0;e<6;e++)t=this.copyBit(e,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(var n=5;n>=0;n--)t=this.copyBit(8,n,t);if(this.parsedFormatInfo=a.decodeFormatInformation(t),null!=this.parsedFormatInfo)return this.parsedFormatInfo;var r=this.bitMatrix.Dimension;t=0;var i=r-8;for(e=r-1;e>=i;e--)t=this.copyBit(e,8,t);for(n=r-7;n<r;n++)t=this.copyBit(8,n,t);if(this.parsedFormatInfo=a.decodeFormatInformation(t),null!=this.parsedFormatInfo)return this.parsedFormatInfo;throw\\\"Error readFormatInformation\\\"},B.prototype.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var t=this.bitMatrix.Dimension,e=t-17>>2;if(e<=6)return u.getVersionForNumber(e);for(var n=0,r=t-11,i=5;i>=0;i--)for(var o=t-9;o>=r;o--)n=this.copyBit(o,i,n);if(this.parsedVersion=u.decodeVersionInformation(n),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==t)return this.parsedVersion;n=0;for(o=5;o>=0;o--)for(i=t-9;i>=r;i--)n=this.copyBit(o,i,n);if(this.parsedVersion=u.decodeVersionInformation(n),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==t)return this.parsedVersion;throw\\\"Error readVersion\\\"},B.prototype.readCodewords=function(){var t=this.readFormatInformation(),e=this.readVersion(),n=N.forReference(t.dataMask),r=this.bitMatrix.Dimension;n.unmaskBitMatrix(this.bitMatrix,r);for(var i=e.buildFunctionPattern(),o=!0,s=new Array(e.totalCodewords),a=0,h=0,f=0,w=r-1;w>0;w-=2){6==w&&w--;for(var u=0;u<r;u++)for(var l=o?r-1-u:u,d=0;d<2;d++)i.get_Renamed(w-d,l)||(f++,h<<=1,this.bitMatrix.get_Renamed(w-d,l)&&(h|=1),8==f&&(s[a++]=h,f=0,h=0));o^=!0}if(a!=e.totalCodewords)throw\\\"Error readCodewords\\\";return s},A.getDataBlocks=function(t,e,n){if(t.length!=e.totalCodewords)throw\\\"ArgumentException\\\";for(var r=e.getECBlocksForLevel(n),i=0,o=r.getECBlocks(),s=0;s<o.length;s++)i+=o[s].count;for(var a=new Array(i),h=0,f=0;f<o.length;f++){var w=o[f];for(s=0;s<w.count;s++){var u=w.dataCodewords,l=r.ecCodewordsPerBlock+u;a[h++]=new A(u,new Array(l))}}for(var d=a[0].codewords.length,c=a.length-1;c>=0;){if(a[c].codewords.length==d)break;c--}c++;var p=d-r.ecCodewordsPerBlock,g=0;for(s=0;s<p;s++)for(f=0;f<h;f++)a[f].codewords[s]=t[g++];for(f=c;f<h;f++)a[f].codewords[p]=t[g++];var v=a[0].codewords.length;for(s=p;s<v;s++)for(f=0;f<h;f++){var m=f<c?s:s+1;a[f].codewords[m]=t[g++]}return a},x.prototype.getNextBits=function(t){var e=0;if(t<this.bitPointer+1){for(var n=0,r=0;r<t;r++)n+=1<<r;return n<<=this.bitPointer-t+1,e=(this.blocks[this.blockPointer]&n)>>this.bitPointer-t+1,this.bitPointer-=t,e}if(t<this.bitPointer+1+8){var i=0;for(r=0;r<this.bitPointer+1;r++)i+=1<<r;return e=(this.blocks[this.blockPointer]&i)<<t-(this.bitPointer+1),this.blockPointer++,e+=this.blocks[this.blockPointer]>>8-(t-(this.bitPointer+1)),this.bitPointer=this.bitPointer-t%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),e}if(t<this.bitPointer+1+16){i=0;var o=0;for(r=0;r<this.bitPointer+1;r++)i+=1<<r;var s=(this.blocks[this.blockPointer]&i)<<t-(this.bitPointer+1);this.blockPointer++;var a=this.blocks[this.blockPointer]<<t-(this.bitPointer+1+8);this.blockPointer++;for(r=0;r<t-(this.bitPointer+1+8);r++)o+=1<<r;return o<<=8-(t-(this.bitPointer+1+8)),e=s+a+((this.blocks[this.blockPointer]&o)>>8-(t-(this.bitPointer+1+8))),this.bitPointer=this.bitPointer-(t-8)%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),e}return 0},x.prototype.NextMode=function(){return this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2?0:this.getNextBits(4)},x.prototype.getDataLength=function(t){for(var e=0;t>>e!=1;)e++;return this.getNextBits(F.sizeOfDataLengthInfo[this.dataLengthMode][e])},x.prototype.getRomanAndFigureString=function(t){var e=t,n=0,r=\\\"\\\",i=[\\\"0\\\",\\\"1\\\",\\\"2\\\",\\\"3\\\",\\\"4\\\",\\\"5\\\",\\\"6\\\",\\\"7\\\",\\\"8\\\",\\\"9\\\",\\\"A\\\",\\\"B\\\",\\\"C\\\",\\\"D\\\",\\\"E\\\",\\\"F\\\",\\\"G\\\",\\\"H\\\",\\\"I\\\",\\\"J\\\",\\\"K\\\",\\\"L\\\",\\\"M\\\",\\\"N\\\",\\\"O\\\",\\\"P\\\",\\\"Q\\\",\\\"R\\\",\\\"S\\\",\\\"T\\\",\\\"U\\\",\\\"V\\\",\\\"W\\\",\\\"X\\\",\\\"Y\\\",\\\"Z\\\",\\\" \\\",\\\"$\\\",\\\"%\\\",\\\"*\\\",\\\"+\\\",\\\"-\\\",\\\".\\\",\\\"/\\\",\\\":\\\"];do{if(e>1)n=this.getNextBits(11),r+=i[Math.floor(n/45)],r+=i[n%45],e-=2;else 1==e&&(r+=i[n=this.getNextBits(6)],e-=1)}while(e>0);return r},x.prototype.getFigureString=function(t){var e=t,n=0,r=\\\"\\\";do{e>=3?((n=this.getNextBits(10))<100&&(r+=\\\"0\\\"),n<10&&(r+=\\\"0\\\"),e-=3):2==e?((n=this.getNextBits(7))<10&&(r+=\\\"0\\\"),e-=2):1==e&&(n=this.getNextBits(4),e-=1),r+=n}while(e>0);return r},x.prototype.get8bitByteArray=function(t){var e=t,n=0,r=[];do{n=this.getNextBits(8),r.push(n),e--}while(e>0);return r},x.prototype.getKanjiString=function(t){var e=t,n=0,r=\\\"\\\";do{var i=((n=this.getNextBits(13))/192<<8)+n%192,o=0;o=i+33088<=40956?i+33088:i+49472,r+=String.fromCharCode(o),e--}while(e>0);return r},Object.defineProperty(x.prototype,\\\"DataByte\\\",{get:function(){for(var t=[];;){var e=this.NextMode();if(0==e){if(t.length>0)break;throw\\\"Empty data block\\\"}if(1!=e&&2!=e&&4!=e&&8!=e&&7!=e)throw\\\"Invalid mode: \\\"+e+\\\" in (block:\\\"+this.blockPointer+\\\" bit:\\\"+this.bitPointer+\\\")\\\";var n=this.getDataLength(e);if(n<1)throw\\\"Invalid data length: \\\"+n;switch(e){case 1:for(var r=this.getFigureString(n),i=new Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);t.push(i);break;case 2:for(r=this.getRomanAndFigureString(n),i=new Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);t.push(i);break;case 4:var s=this.get8bitByteArray(n);t.push(s);break;case 8:r=this.getKanjiString(n);t.push(r)}}return t}});var E={};E.rsDecoder=new P(k.QR_CODE_FIELD),E.correctErrors=function(t,e){for(var n=t.length,r=new Array(n),i=0;i<n;i++)r[i]=255&t[i];var o=t.length-e;try{E.rsDecoder.decode(r,o)}catch(t){throw t}for(i=0;i<e;i++)t[i]=r[i]},E.decode=function(t){for(var e=new B(t),n=e.readVersion(),r=e.readFormatInformation().errorCorrectionLevel,i=e.readCodewords(),o=A.getDataBlocks(i,n,r),s=0,a=0;a<o.length;a++)s+=o[a].numDataCodewords;for(var h=new Array(s),f=0,w=0;w<o.length;w++){var u=o[w],l=u.codewords,d=u.numDataCodewords;E.correctErrors(l,d);for(a=0;a<d;a++)h[f++]=l[a]}return new x(h,n.versionNumber,r.bits)};var D=E,F={};function O(){this.imagedata=null,this.width=0,this.height=0,this.qrCodeSymbol=null,this.debug=!1,this.callback=null}function I(t,e){return t>=0?t>>e:(t>>e)+(2<<~e)}F.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]],O.prototype.decode=function(t,e){var n=function(){try{this.error=void 0,this.result=this.process(this.imagedata)}catch(t){this.error=t,this.result=void 0}return null!=this.callback&&this.callback(this.error,this.result),this.result}.bind(this);if(null!=t&&null!=t.width)this.width=t.width,this.height=t.height,this.imagedata={data:e||t.data},this.imagedata.width=t.width,this.imagedata.height=t.height,n();else{if(\\\"undefined\\\"==typeof Image)throw new Error(\\\"This source format is not supported in your environment, you need to pass an image buffer with width and height (see https://github.com/edi9999/jsqrcode/blob/master/test/qrcode.js)\\\");var r=new Image;r.crossOrigin=\\\"Anonymous\\\",r.onload=function(){var t=document.createElement(\\\"canvas\\\"),e=t.getContext(\\\"2d\\\"),i=document.getElementById(\\\"out-canvas\\\");if(null!=i){var o=i.getContext(\\\"2d\\\");o.clearRect(0,0,320,240),o.drawImage(r,0,0,320,240)}t.width=r.width,t.height=r.height,e.drawImage(r,0,0),this.width=r.width,this.height=r.height;try{this.imagedata=e.getImageData(0,0,r.width,r.height)}catch(t){if(this.result=\\\"Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!\\\",null!=this.callback)return this.callback(null,this.result)}n()}.bind(this),r.src=t}},O.prototype.decode_utf8=function(t){return decodeURIComponent(escape(t))},O.prototype.process=function(t){for(var e=(new Date).getTime(),n=new C(this.grayScaleToBitmap(this.grayscale(t))).detect(),r=D.decode(n.bits).DataByte,i=\\\"\\\",o=0;o<r.length;o++)for(var s=0;s<r[o].length;s++)i+=String.fromCharCode(r[o][s]);var a=(new Date).getTime()-e;return this.debug&&console.log(\\\"QR Code processing time (ms): \\\"+a),{result:this.decode_utf8(i),points:n.points}},O.prototype.getPixel=function(t,e,n){if(t.width<e)throw\\\"point error\\\";if(t.height<n)throw\\\"point error\\\";var r=4*e+n*t.width*4;return(33*t.data[r]+34*t.data[r+1]+33*t.data[r+2])/100},O.prototype.binarize=function(t){for(var e=new Array(this.width*this.height),n=0;n<this.height;n++)for(var r=0;r<this.width;r++){var i=this.getPixel(r,n);e[r+n*this.width]=i<=t}return e},O.prototype.getMiddleBrightnessPerArea=function(t){for(var e=Math.floor(t.width/4),n=Math.floor(t.height/4),r=new Array(4),i=0;i<4;i++){r[i]=new Array(4);for(var o=0;o<4;o++)r[i][o]=[0,0]}for(var s=0;s<4;s++)for(var a=0;a<4;a++){r[a][s][0]=255;for(var h=0;h<n;h++)for(var f=0;f<e;f++){var w=t.data[e*a+f+(n*s+h)*t.width];w<r[a][s][0]&&(r[a][s][0]=w),w>r[a][s][1]&&(r[a][s][1]=w)}}for(var u=new Array(4),l=0;l<4;l++)u[l]=new Array(4);for(s=0;s<4;s++)for(a=0;a<4;a++)u[a][s]=Math.floor((r[a][s][0]+r[a][s][1])/2);return u},O.prototype.grayScaleToBitmap=function(t){for(var e=this.getMiddleBrightnessPerArea(t),n=e.length,r=Math.floor(t.width/n),i=Math.floor(t.height/n),o=0;o<n;o++)for(var s=0;s<n;s++)for(var a=0;a<i;a++)for(var h=0;h<r;h++)t.data[r*s+h+(i*o+a)*t.width]=t.data[r*s+h+(i*o+a)*t.width]<e[s][o];return t},O.prototype.grayscale=function(t){for(var e=new Array(t.width*t.height),n=0;n<t.height;n++)for(var r=0;r<t.width;r++){var i=this.getPixel(t,r,n);e[r+n*t.width]=i}return{height:t.height,width:t.width,data:e}};e.default=O}]);\";","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  const {navigator} = window;\n\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const addIceCandidateNullSupported =\n    window.RTCPeerConnection.prototype.addIceCandidate.length === 0;\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!addIceCandidateNullSupported && !arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window) {\n  const browserDetails = utils.detectBrowser(window);\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params)) {\n            params.encodings = initParameters.sendEncodings;\n            sender.sendEncodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        var params = origGetParameters.apply(this, arguments);\n        if (!('sendEncodings' in this)) {\n          return params;\n        }\n        return Object.assign({}, {encodings: this.sendEncodings}, params);\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter = adapterFactory({window});\nexport default adapter;\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimGetParameters(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimAudioContext(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n"],"sourceRoot":""}